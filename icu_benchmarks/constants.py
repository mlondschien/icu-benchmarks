from pathlib import Path
from typing import Any, Dict

DATA_DIR = Path(__file__).parents[1] / "data"
VARIABLE_REFERENCE_PATH = (
    Path(__file__).parents[1] / "resources" / "variable_reference.tsv"
)

HORIZONS = [8, 24, 72]

DATASETS = [
    "mimic",
    "mimic-metavision",
    "mimic-carevue",
    "miived",
    "miiv",
    "miiv-late",
    "eicu",
    "hirid",
    "aumc",
    "aumc-early",
    "aumc-late",
    "sic",
    "zigong",
    "picdb",
    "nwicu",
]


OUTCOMES = [
    "remaining_los",
    "mortality_at_24h",
    "los_at_24h",
    "decompensation_at_24h",
    "respiratory_failure_at_24h",
    "circulatory_failure_at_8h",
    "kidney_failure_at_48h",
    "log_creatine_in_1h",
    "log_lactate_in_1h",
    "log_lactate_in_8h",
    "log_rel_urine_rate_in_1h",
    "log_rel_urine_rate_in_8h",
    "log_po2",
]

# Approx. number of rows per GB of memory. If all ~1000 columns were float64, this would
# be ~125_000. We get a bit less due to boolean and categorical columns.
OBSERVATIONS_PER_GB = 160_000

TASKS: Dict[str, Dict[str, Any]] = {
    "remaining_los": {
        "task": "regression",
        "family": "gamma",
        "alpha_max": 0.6,
        "n_samples": {
            "mimic": 4586276,
            "ehrshot": 0,
            "miived": 0,
            "miiv": 5530815,
            "eicu": 12096141,
            "hirid": 1781542,
            "aumc": 1832031,
            "sic": 1858134,
            "zigong": 387493,
            "picdb": 0,
            "mimic-metavision": 1846108,
            "mimic-carevue": 2689494,
            "miiv-late": 2329717,
            "aumc-early": 863355,
            "aumc-late": 968676,
        },
    },
    "mortality_at_24h": {
        "task": "classification",
        "family": "binomial",
        "alpha_max": 0.07,
        "n_samples": {
            "mimic": 45018,
            "ehrshot": 32890,
            "miived": 0,
            "miiv": 57721,
            "eicu": 132388,
            "hirid": 16611,
            "aumc": 12762,
            "sic": 19486,
            "zigong": 2422,
            "picdb": 0,
            "mimic-metavision": 19544,
            "mimic-carevue": 25007,
            "miiv-late": 23675,
            "aumc-early": 5544,
            "aumc-late": 7218,
        },
    },
    "los_at_24h": {
        "task": "regression",
        "family": "gamma",
        "alpha_max": 0.5,
        "n_samples": {
            "mimic": 45018,
            "ehrshot": 0,
            "miived": 0,
            "miiv": 57721,
            "eicu": 132388,
            "hirid": 16611,
            "aumc": 12762,
            "sic": 19486,
            "zigong": 2422,
            "picdb": 0,
            "mimic-metavision": 19544,
            "mimic-carevue": 25007,
            "miiv-late": 23675,
            "aumc-early": 5544,
            "aumc-late": 7218,
        },
    },
    "decompensation_at_24h": {
        "task": "classification",
        "family": "binomial",
        "alpha_max": 0.025,
        "n_samples": {
            "mimic": 3484186,
            "ehrshot": 3049961,
            "miived": 0,
            "miiv": 4034764,
            "eicu": 12097602,
            "hirid": 1105836,
            "aumc": 1832148,
            "sic": 1381888,
            "zigong": 382308,
            "picdb": 0,
            "mimic-metavision": 1355081,
            "mimic-carevue": 2089759,
            "miiv-late": 1729782,
            "aumc-early": 863397,
            "aumc-late": 968751,
        },
    },
    "respiratory_failure_at_24h": {
        "task": "classification",
        "family": "binomial",
        "alpha_max": 0.25,
        "n_samples": {
            "mimic": 1024368,
            "ehrshot": 72164,
            "miived": 0,
            "miiv": 1039351,
            "eicu": 2195867,
            "hirid": 646056,
            "aumc": 884307,
            "sic": 486802,
            "zigong": 0,
            "picdb": 0,
            "mimic-metavision": 419231,
            "mimic-carevue": 596755,
            "miiv-late": 396882,
            "aumc-early": 491795,
            "aumc-late": 392512,
        },
        "variables": [
            "age",
            "anti_coag_ind",
            "cf_treat_ind",
            "diur_ind",
            "fio2",
            "ins_ind",
            "map",
            "mgcs",
            "o2sat",
            "pco2",
            "peak",
            "peep",
            "pf_ratio",
            "po2",
            "resp",
            "sed_ind",
            "sex",
            "supp_o2_vent",
            "temp",
            "tgcs",
            "airway_ind",
        ],
    },
    "circulatory_failure_at_8h": {
        "task": "classification",
        "family": "binomial",
        "alpha_max": 0.25,
        "n_samples": {
            "mimic": 333741,
            "ehrshot": 14266,
            "miived": 0,
            "miiv": 536568,
            "eicu": 369373,
            "hirid": 685413,
            "aumc": 281161,
            "sic": 1172015,
            "zigong": 2730,
            "picdb": 0,
            "mimic-metavision": 153409,
            "mimic-carevue": 178508,
            "miiv-late": 244304,
            "aumc-early": 68998,
            "aumc-late": 212163,
        },
        "variables": [
            "age",
            "cf_treat_ind",
            "cout",
            "crp",
            "dbp",
            "glu",
            "hr",
            "inr_pt",
            "lact",
            "map",
            "nonop_pain_ind",
            "o2sat",
            "peak",
            "rass",
            "sbp",
            "supp_o2_vent",
        ]
    },
    "kidney_failure_at_48h": {
        "task": "classification",
        "family": "binomial",
        "alpha_max": 0.15,
        "n_samples": {
            "mimic": 3106408,
            "ehrshot": 62150,
            "miived": 0,
            "miiv": 4162842,
            "eicu": 5999611,
            "hirid": 996732,
            "aumc": 1516864,
            "sic": 1394791,
            "zigong": 0,
            "picdb": 0,
            "mimic-metavision": 1374815,
            "mimic-carevue": 1715448,
            "miiv-late": 1759023,
            "aumc-early": 714400,
            "aumc-late": 802464,
        },
        "variables": [
            "abx_ind",
            "airway_ind",
            "anti_coag_ind",
            "anti_delir_ind",
            "bili",
            "cf_treat_ind",
            "crea",
            "crp",
            "diur_ind",
            "fluid_ind",
            "inf_rbc_ind",
            "k",
            "mg",
            "pain_killer_ind",
            "rel_urine_rate",
            "resp",
            "ufilt_ind",
            "weight",
        ]
    },
    "log_creatine_in_1h": {
        "task": "regression",
        "family": "gaussian",
        "n_samples": {
            "mimic": 278792,
            "ehrshot": 70821,
            "miived": 0,
            "miiv": 372784,
            "eicu": 604236,
            "hirid": 69649,
            "aumc": 109604,
            "sic": 92011,
            "zigong": 9951,
            "picdb": 0,
            "mimic-metavision": 118577,
            "mimic-carevue": 157241,
            "miiv-late": 159329,
            "aumc-early": 53878,
            "aumc-late": 55726,
        },
        "alpha_max": 0.53,
    },
    "log_lactate_in_1h": {
        "task": "regression",
        "family": "gaussian",
        "n_samples": {
            "mimic": 111135,
            "ehrshot": 10809,
            "miived": 0,
            "miiv": 197415,
            "eicu": 116096,
            "hirid": 205320,
            "aumc": 114515,
            "sic": 489852,
            "zigong": 10976,
            "picdb": 0,
            "mimic-metavision": 52425,
            "mimic-carevue": 57445,
            "miiv-late": 93007,
            "aumc-early": 21505,
            "aumc-late": 93010,
        },
        "alpha_max": 0.54,
    },
    "log_lactate_in_8h": {
        "task": "regression",
        "family": "gaussian",
        "n_samples": {
            "mimic": 87361,
            "mimic-metavision": 40473,
            "mimic-carevue": 45856,
            "miived": 0,
            "miiv": 150488,
            "miiv-late": 71150,
            "eicu": 81666,
            "hirid": 165926,
            "aumc": 95121,
            "aumc-early": 17338,
            "aumc-late": 77783,
            "sic": 419345,
            "zigong": 9248,
            "picdb": 0,
        },
        "alpha_max": 0.46,
    },
    "log_rel_urine_rate_in_1h": {
        "task": "regression",
        "family": "gaussian",
        "n_samples": {
            "mimic": 2513691,
            "mimic-metavision": 1071446,
            "mimic-carevue": 1429682,
            "miived": 0,
            "miiv": 2949409,
            "miiv-late": 1178268,
            "eicu": 2942815,
            "hirid": 434608,
            "aumc": 1164204,
            "aumc-early": 562179,
            "aumc-late": 602025,
            "sic": 1417030,
            "zigong": 0,
            "picdb": 0,
        },
        "alpha_max": 0.8,
    },
    "log_rel_urine_rate_in_8h": {
        "task": "regression",
        "family": "gaussian",
        "n_samples": {
            "mimic": 2337842,
            "mimic-metavision": 985846,
            "mimic-carevue": 1339860,
            "miived": 0,
            "miiv": 2697160,
            "miiv-late": 1081225,
            "eicu": 2648121,
            "hirid": 384372,
            "aumc": 1059385,
            "aumc-early": 517004,
            "aumc-late": 542381,
            "sic": 1313309,
            "zigong": 0,
            "picdb": 0,
        },
        "alpha_max": 0.8,
    },
}
